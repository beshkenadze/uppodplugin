var Uppod=Class.create();Uppod.prototype={options:{debug:false,player_id:"uppod_player_"+Math.random(),width:500,src:"swf/uppod.swf",height:375,params:{allowFullScreen:true},vars:{uid:false}},toElement:function(){return this.object},initialize:function(a,b){this.setOptions(b);b=this.options;this.player_id=this.options.player_id;this.container=a;this.width=this.options.width;this.height=this.options.height;this.params=this.options.params;this.vars=this.options.vars;this.vars.uid=this.player_id;this.src=this.options.src;this.timed=false;this.time=false;if(this.options.debug){if($("uppod-debug")){var c=$("uppod-debug")}else{var c=new Element("div",{id:"uppod-debug","class":"debug"});document.body.insert(c)}}this.init()},init:function(){if(!$(this.container)){this.error("Не найден контейнер #"+this.container+" , аварийное завершение.");return}if($(this.player_id)){this.error('Плеер "'+this.player_id+'" уже существует , аварийное завершение.');return}this.obj=new Swiff(this.src+"?"+Math.random(),{id:this.player_id,container:this.container,width:this.width,height:this.height,params:this.params,vars:this.vars});this.player=this.getMovie(this.player_id);if(typeof this.player=="undefined"){this.error('Не могу обратится к плееру "'+this.player_id+'", аварийное завершение.');return}this.bind()},log:function(b){if(this.options.debug){if(b&&b.length>0){if(console){console.info(b)}else{if($$("#uppod-debug p").length>10){$("uppod-debug").empty()}var c=new Element("p",{"class":"log",html:"Плеер "+this.player_id+" сообщает: "+b});var a=$("uppod-debug");c.inject(a)}}}},error:function(c){if(this.options.debug){if(c&&c.length>0){if(console){console.error(c)}else{var d=new Element("p",{"class":"error",html:c});var b=$("uppod-debug");var a=b.get("html");d.inject(b)}}}},bind:function(){var a=this.player;var b=this},getMovie:function(a){if(Browser.browser=="Explorer"){return window[a]}else{return document[a]}},cmd:function(c,b,d){var a=c+(b?":"+b:"");this.log("посылаю комманду "+a);if((typeof this.player.sendToUppod!="undefined")&&typeof this.player!="undefined"){return this.player.sendToUppod(a,(d?d:""))}else{this.error("Не могу выполнить комманду: "+c+' к плееру "'+this.player_id+'", аварийное завершение.')}},file:function(a){this.cmd("file")},play:function(){this.cmd("play")},pause:function(){this.cmd("pause")},toggle:function(){this.cmd("toggle")},stop:function(){this.cmd("stop")},seek:function(a){return this.cmd("seek",a)},getpl:function(){return this.cmd("getpl")},getv:function(){return this.cmd("getv")},getTime:function(a){return this.cmd("getime","",a)},getTimed:function(a){return this.cmd("getimed","",a)},getStatus:function(a){return this.cmd("getstatus","",a)},getFull:function(a){return this.cmd("getfull","",a)},setTimed:function(a){this.timed=a},setTime:function(a){this.time=a},volume:function(a){if(typeof a!="number"){a=50}if(a<0){a=0}if(a>100){a=100}this.cmd("v"+a)},setClosedText:function(a){return this.cmd("text",a)},setText:function(a){return this.cmd("text2",a)},setPl:function(a){return this.cmd("pl",JSON.encode(a))},removeText:function(){return this.cmd("xtext")},removePl:function(){return this.cmd("xpl")},random:function(){return this.cmd("random")},fullscreen:function(){return this.cmd("fullscreen")},start:function(a){if(typeof a!="number"){a=50}if(a<0){a=0}if(a>100){a=100}this.cmd("start"+a)},startTimer:function(callback,period){eval(callback);var parent=this;this.timer=setTimeout(function(){parent.startTimer(callback,period)},period)},stopTime:function(){clearTimeout(this.timer)},setOptions:function(a){this.options=Object.extend(this.options,a)},};var Swiff=Class.create({options:{id:null,height:1,width:1,container:null,properties:{},params:{quality:"high",allowScriptAccess:"always",wMode:"transparent",swLiveConnect:true},callBacks:{},vars:{}},toElement:function(){return this.object},initialize:function(l,m){this.instance="Swiff_"+new Date().getTime();this.setOptions(m);m=this.options;var b=this.id=m.id||this.instance;var a=$(m.container);Swiff.CallBacks[this.instance]={};var e=m.params,g=m.vars,f=m.callBacks;var h=Object.extend({height:m.height,width:m.width},m.properties);var k=this;for(var d in f){Swiff.CallBacks[this.instance][d]=(function(n){return function(){return n.apply(k.object,arguments)}})(f[d]);g[d]="Swiff.CallBacks."+this.instance+"."+d}e.flashVars=Hash.toQueryString(g);if(Prototype.Browser.IE){h.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000";e.movie=l}else{h.type="application/x-shockwave-flash";h.data=l}var j='<object id="'+b+'"';for(var i in h){j+=" "+i+'="'+h[i]+'"'}j+=">";for(var c in e){if(e[c]){j+='<param name="'+c+'" value="'+e[c]+'" />'}}j+="</object>";this.object=((a)?a.update():new Element("div")).update(j).firstChild},setOptions:function(a){this.options=Object.extend(this.options,a)},replaces:function(a){a=$(a,true);a.parentNode.replaceChild(this.toElement(),a);return this},inject:function(a){$(a,true).appendChild(this.toElement());return this},remote:function(){return Swiff.remote.apply(Swiff,[this.toElement()].extend(arguments))}});Swiff.CallBacks={};Swiff.remote=function(obj,fn){var rs=obj.CallFunction('<invoke name="'+fn+'" returntype="javascript">'+__flash__argumentsToXML(arguments,2)+"</invoke>");return eval(rs)};var Browser={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(d){for(var a=0;a<d.length;a++){var b=d[a].string;var c=d[a].prop;this.versionSearchString=d[a].versionSearch||d[a].identity;if(b){if(b.indexOf(d[a].subString)!=-1){return d[a].identity}}else{if(c){return d[a].identity}}}},searchVersion:function(b){var a=b.indexOf(this.versionSearchString);if(a==-1){return}return parseFloat(b.substring(a+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};Browser.init();